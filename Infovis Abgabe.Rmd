---
title: "Infovis Abgabe"
author: "Leonie Düttmann, Laura Schröder"
date: "5 6 2019"
output: html_document
---

##College Abschlüsse in den USA und das Phänomen "Gender Pay Gap"
Hier Erklärtext zum Problem.
```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, echo = FALSE)
#install.packages("gridExtra")
library(tidyverse)
library(lubridate)
library(ggplot2)
library(esquisse)
library(gridExtra)
library(here)

```


```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
jobs_gender <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-03-05/jobs_gender.csv")
earnings_female <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-03-05/earnings_female.csv") 
employed_gender <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-03-05/employed_gender.csv") 



college_major <- readr::read_csv("recent-grads.csv")

rwthcolors <- hcictools::rwth.colorpalette()

```
### College Abschlüsse und Arbeitsbereiche nach Geschlecht
Erklärtext blabla

```{r Diagramme I College Major nach Kategorie und Geschlecht; female und male workers nach major category, echo=FALSE}

college_major %>% select(Men, Women, Major_category, Major) %>% 
  gather(gender, value, -Major_category, -Major) %>% 
  group_by(Major_category, gender) %>% 
  summarize(subtotal = sum(value)) %>%
  ungroup() %>% 
  mutate(Major_category = fct_reorder(Major_category, subtotal)) %>% 
  ggplot() +
  aes(x = Major_category, y = subtotal, fill = gender) + geom_col() + coord_flip() +
  scale_fill_manual(values = c(rwthcolors$blue, rwthcolors$red)) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  labs(title = "Es herrscht ein ausgeglichenes Verhältnis im Business Sektor",
       subtitle = "Balkendiagramm von Abschluss nach Geschlecht",
       x = "Major Category",
       y = "Häufigkeit (in Prozent)",
       fill = "Legend")



jobs_gender %>% select(major_category, minor_category, workers_male, workers_female) %>% 
  gather(gender, value, -major_category, -minor_category) %>% 
  group_by(major_category, gender) %>% 
  summarize(subtotal = sum(value)) %>% 
  ungroup() %>% 
  mutate(major_category = fct_reorder(major_category, subtotal)) %>% 
  ggplot() +
  aes(x = major_category, y = subtotal, fill = gender) + geom_col() + coord_flip() +
  scale_fill_manual(values = c(rwthcolors$red, rwthcolors$blue)) +
 scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  labs(title = "In Büro-Jobs ist das Verhältnis relativ ausgeglichen",
       subtitle = "Balkendiagramm von Job Kategorie nach Geschlecht",
       x = "Major Category",
       y = "Häufigkeit (in Prozent)",
       fill = "Legend")
  


```

#### Ergebnisanalyse I
Hier kommt das erste Zwischenfazit. Keyfindings I: Business Sektor relativ ausgegleichen, ebenso sozialer Bereich. Technischer Bereich eher Männer; Gesundheit, Psychologie eher Frauen.
Keyfindings II: Business und Service sehr ausgeglichen; Produktion, Construction Work und Technik eher Männer; Gesundhei, Kunst und Medien eher Frauen.

### Wer arbeitet eigentlich mehr Vollzeit?
Phänomen Frauen arbeiten oft auf Teilzeit, um bei den Kindern zu bleiben blabla.

```{r full-time und part-time Vergleich}


college_major %>% 
  select(Full_time, Part_time, Unemployed) %>% 
  gather(variable, value) %>%
  mutate(type_of_work = case_when(
    str_detect(variable, "Part") ~ "part time",
    str_detect(variable, "Full") ~ "full time",
    str_detect(variable, "Unemployed") ~ "unemployed")) %>%  
  mutate(value = value / 100) %>% 
  ggplot() +
  aes(x = type_of_work, y = value, fill = type_of_work) + 
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  scale_fill_manual(values = c(rwthcolors$turquois, rwthcolors$orange, rwthcolors$petrol)) +
  labs(title = "Das Verhältnis zwischen Vollzeit, Teilzeit und arbeitslos",
       subtitle = "Balkendiagramm",
       x = "Type of Work",
       y = "Absolute Häufigkeit",
       fill = "Legend") 


# Version 2

employed_gender %>% 
  filter(year == 2013) %>% 
  select(-starts_with("total")) %>% 
  gather(variable, value, -year) %>%
  mutate(gender = case_when(
    str_detect(variable, "female") ~ "female",
    str_detect(variable, "male") ~ "male"),
    type_of_work = case_when(
    str_detect(variable, "part") ~ "part time",
    str_detect(variable, "full") ~ "full time")) %>%  
  mutate(value = value / 100) %>% 
  ggplot() +
  aes(x = gender, y = value, fill = type_of_work) + 
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
   scale_fill_manual(values = c(rwthcolors$turquois, rwthcolors$orange)) +
  labs(title = "Verhältnis von Vollzeit und Teilzeit",
       subtitle = "Balkendiagramm von Arbeitsverhältnis nach Geschlecht",
       x = "Gender",
       y = "Value",
       fill = "Legend")
  

# Das macht dann eher wenig Sinn? Full-time und part-time hat sich bei Frauen über die Jahre nicht verändert.
employed_gender %>% 
  select(-starts_with("total")) %>% 
  gather(variable, value, -year) %>%
  mutate(gender = case_when(
    str_detect(variable, "female") ~ "female"),
    type_of_work = case_when(
    str_detect(variable, "part") ~ "part time",
    str_detect(variable, "full") ~ "full time")) %>%  
  mutate(value = value / 100) %>% 
  ggplot() +
  aes(x = year, y = value, fill = type_of_work) + 
 geom_smooth() +
  labs(title = "Kaum Veränderung bei Beschäftigungsverhältnissen bei Frauen",
       subtitle = "Liniendiagramm von Jahren nach Geschlecht",
       x = "Year",
       y = "Value (in percent)",
       fill = "Legend")

```

#### Zwischenanalyse II
Generell arbeiten mehr Menschen Vollzeit als Teilzeit. Bei College Abschlüssen ist die Arbeitslosigkeit vergleichsweise gering. Frauen arbeiten deutlich öfter in Teilzeit als Männer. Über die Jahre hat sich die Prozentzahl von Frauen in Voll- und Teilzeit aber kaum verändert. 

### Wie sieht es in den Kategorien nach dem College aus?
Erklärtext und so weiter.

```{r College Jobs, Non College Jobs, Low Wage Jobs}

college_major %>% 
 select(College_jobs, Non_college_jobs, Low_wage_jobs) %>% 
  gather(variable, value) %>%
  mutate(jobs = case_when(
    str_detect(variable, "College") ~ "College Jobs",
    str_detect(variable, "Non") ~ "Non-College Jobs",
    str_detect(variable, "Low") ~ "Low Wage Jobs")) %>%  
  mutate(value = value / 100) %>% 
  ggplot() +
  aes(x = jobs, y = value, fill = jobs) + 
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  scale_fill_manual(values = c(rwthcolors$lightblue, rwthcolors$yellow, rwthcolors$maygreen)) +
  labs(title = "Es gibt kaum einen Unterschied zwischen College und Non-College Jobs",
       subtitle = "Balkendiagramm von Arbeit nach Kategorie",
       x = "Jobs",
       y = "Value",
       fill = "Legend")


  
```

#### Zwischenfazit
Kaum Unterschied zwischen College und Non-College Jobs. Deutlicher Unterschied zu Low-Wage Jobs. Es arbeiten also weniger Absolventen im Low Wage Bereich. 

### Gender Pay Gap
Schauen wir uns mal genauer an, was es mit dem Gender Pay Gap so auf sich hat. Ist das alles nur ein medial verbreitetes Problem? 
So sah es 2013 in den USA aus. 

```{r Vergleich Gehalt Männer und Frauen}


jobs_gender %>% 
  filter(year == 2013, major_category!= "Healthcare Practitioners and Technical") %>% 
  select(major_category, year, total_earnings, total_earnings_male, total_earnings_female) %>% 
  gather(gender, value, -year, -major_category, -total_earnings) %>% 
  group_by (major_category, gender) %>% 
  summarize(subtotal = sum(value)) %>% 
  ungroup() %>% 
  mutate(major_category = fct_reorder(major_category, subtotal)) %>% 
  ggplot() +
  aes(x = major_category, y= subtotal, fill = gender) +
  coord_flip() +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Unterschiedliche Gehaltszahlungen nach Arbeit",
       subtitle = "Balkendiagramm von Arbeitskategorie nach Geschlecht",
       x = "Major Category",
       y = "Earnings",
       fill = "Legend")
   
```

Man sieht in den Oberkategorien schon einen Unterschied in der Bezahlung. Zu drei gibt es keine Daten vom Verdienst der Frauen. Wie das in den Unterkategorien aussieht, schauen wir uns jetzt an:

```{r}
jobs_gender %>% 
  filter(year == 2013, major_category!= "Healthcare Practitioners and Technical") %>% 
  select(minor_category, year, total_earnings, total_earnings_male, total_earnings_female) %>% 
  gather(gender, value, -year, -minor_category, -total_earnings) %>% 
  group_by (minor_category, gender) %>% 
  summarize(subtotal = sum(value)) %>% 
  ungroup() %>% 
  mutate(minor_category = fct_reorder(minor_category, subtotal)) %>% 
  ggplot() +
  aes(x = minor_category, y= subtotal, fill = gender) +
  coord_flip() +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Unterschiedliche Gehaltszahlungen aufgeschlüsselt nach Unterkategorien",
       subtitle = "Balkendiagramm von Arbeitskategorie nach Geschlecht",
       x = "Major Category",
       y = "Earnings",
       fill = "Legend")
```

#### Ergebnis
Es gibt oft einen deutlichen Unterschied in der Bezahlung von Männern und Frauen. Frauen verdienen oft weniger. Im Pflegebereich ist es fast ausgeglichen, aber auch dort verdienen Frauen weniger. 
